!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Tails=e()}}(function(){return function e(t,n,r){function i(u,s){if(!n[u]){if(!t[u]){var l="function"==typeof require&&require;if(!s&&l)return l(u,!0);if(o)return o(u,!0);var a=new Error("Cannot find module '"+u+"'");throw a.code="MODULE_NOT_FOUND",a}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[u].exports}for(var o="function"==typeof require&&require,u=0;u<r.length;u++)i(r[u]);return i}({1:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("../node_modules/sonic/dist/linked_list"),o=e("./utils"),u=e("../node_modules/knuckles/dist/simple_record"),s=function(e){function t(n){var r=this;e.call(this,n),this._belongsTo=function(e){var n=e.name,i=o["default"].underscore(n)+"_id";return r.zoom(i).flatMap(function(n){return t.where(e.all(),"id",n)})},this._hasOne=function(e){return r._hasMany(e)},this._hasMany=function(e){var n=r.constructor.name,i=o["default"].underscore(n)+"_id";return r.zoom("id").flatMap(function(n){return t.where(e.all(),i,n)})},this.constructor.all().push(this)}return r(t,e),t._keyFn=function(e){return e.get("id")||null},t.all=function(){return null==this._collection&&(this._collection=new i["default"]([],this._keyFn)),this._collection},t.where=function(e,n,r){return t.pluck(e,n).filter(function(e){var t=(e[0],e[1]);return t===r}).map(function(e){return e[0]})},t.pluck=function(e,t){return e.flatMap(function(e){return e.zoom(t).map(function(t){return[e,t]})})},t}(u["default"]);n["default"]=s},{"../node_modules/knuckles/dist/simple_record":6,"../node_modules/sonic/dist/linked_list":18,"./utils":2}],2:[function(e,t,n){var r;!function(e){function t(e){return e.replace(/((!?[^|\s])[A-Z][a-z0-9])/,"_$1").toLowerCase()}e.underscore=t}(r=n.Utils||(n.Utils={})),n["default"]=r},{}],3:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./observable_record"),o=e("../node_modules/sonic/dist/mutable_list"),u=function(e){function t(n){var r=this;e.call(this,n),this.set=function(e,t){throw new Error("Not implemented")},this["delete"]=function(e){throw new Error("Not implemented")},this.zoom=function(e){return o.MutableList.create(t.zoom(r,e))},null!=n&&(this.set=n.set,this["delete"]=n["delete"])}return r(t,e),t.create=function(e){return new i.ObservableRecord(e)},t.zoom=function(e,t){function n(n,r){n==t&&e.set(t,r)}function r(n,r){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];i.length?e.set(t,i[0]):e["delete"](t)}var o=i.ObservableRecord.zoom(e,t);return{has:o.has,get:o.get,prev:o.prev,next:o.next,observe:o.observe,set:n,splice:r}},t}(i.ObservableRecord);n.MutableRecord=u,n["default"]=u},{"../node_modules/sonic/dist/mutable_list":10,"./observable_record":4}],4:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("../node_modules/sonic/dist/unit"),o=e("./record"),u=e("../node_modules/sonic/dist/observable_list"),s=function(e){function t(n){var r=this;e.call(this,n),this.observe=function(e){throw new Error("Not implemented")},this.zoom=function(e){return u.ObservableList.create(t.zoom(r,e))},null!=n&&(this.observe=n.observe)}return r(t,e),t.create=function(e){return new t(e)},t.zoom=function(e,t){var n=new i["default"];return e.has(t)&&n.set(t,e.get(t)),e.observe({onInvalidate:function(t){e.has(t)?n.set(t,e.get(t)):n.splice(null,null)}}),{has:n.has,get:n.get,prev:n.prev,next:n.next,observe:n.observe}},t}(o.Record);n.ObservableRecord=s,n["default"]=s},{"../node_modules/sonic/dist/observable_list":13,"../node_modules/sonic/dist/unit":15,"./record":5}],5:[function(e,t,n){var r=e("../node_modules/sonic/dist/unit"),i=e("../node_modules/sonic/dist/list"),o=function(){function e(t){var n=this;this.has=function(e){throw new Error("Not implemented")},this.get=function(e){throw new Error("Not implemented")},this.zoom=function(t){return i.List.create(e.zoom(n,t))},null!=t&&(this.get=t.get,this.has=t.has)}return e.create=function(t){return new e(t)},e.zoom=function(e,t){var n=new r["default"];return e.has(t)&&n.set(t,e.get(t)),{has:n.has,get:n.get,prev:n.prev,next:n.next}},e}();n.Record=o,n["default"]=o},{"../node_modules/sonic/dist/list":9,"../node_modules/sonic/dist/unit":15}],6:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./mutable_record"),o=e("../node_modules/sonic/dist/observable"),u=function(e){function t(t){var n=this;e.call(this),this.has=function(e){return e in n._object},this.get=function(e){return n._object[e]},this.observe=function(e){return n._subject.observe(e)},this.set=function(e,t){n._object[e]=t,n._subject.notify(function(t){t.onInvalidate(e)})},this["delete"]=function(e){e in n._object&&(delete n._object[e],n._subject.notify(function(t){t.onInvalidate(e)}))},this._object=t,this._subject=new o.Subject}return r(t,e),t}(i.MutableRecord);n["default"]=u},{"../node_modules/sonic/dist/observable":11,"./mutable_record":3}],7:[function(e,t,n){var r=function(){function e(e){this._byKey=Object.create(null),this._next=Object.create(null),this._prev=Object.create(null),this._list=e}return e.prototype.has=function(e){return e in this._byKey||this._list.has(e)},e.prototype.get=function(e){return e in this._byKey?this._byKey[e]:this._list.has(e)?this._byKey[e]=this._list.get(e):void 0},e.prototype.prev=function(e){if(e in this._prev)return this._prev[e];var t=this._list.prev(e);return null==t&&(t=null),this._prev[e]=t,this._next[t]=e,t},e.prototype.next=function(e){if(void 0===e&&(e=null),e in this._next)return this._next[e];var t=this._list.next(e);return null==t&&(t=null),this._next[e]=t,this._prev[t]=e,t},e}();n["default"]=r},{}],8:[function(e,t,n){var r;!function(e){function t(e){return e.toString()}function n(){return r++}var r=0;e.key=t,e.create=n}(r||(r={})),n["default"]=r},{}],9:[function(e,t,n){var r=e("./tree"),i=e("./cache"),o=function(){function e(t){var n=this;this.has=function(e){throw new Error("Not implemented")},this.get=function(e){throw new Error("Not implemented")},this.prev=function(e){throw new Error("Not implemented")},this.next=function(e){throw new Error("Not implemented")},this.first=function(){return e.first(n)},this.last=function(){return e.last(n)},this.forEach=function(t){return e.forEach(n,t)},this.reduce=function(t,r){return e.reduce(n,t)},this.toArray=function(){return e.toArray(n)},this.findKey=function(t){return e.findKey(n,t)},this.find=function(t){return e.find(n,t)},this.keyOf=function(t){return e.keyOf(n,t)},this.indexOf=function(t){return e.indexOf(n,t)},this.keyAt=function(t){return e.keyAt(n,t)},this.at=function(t){return e.at(n,t)},this.every=function(t){return e.every(n,t)},this.some=function(t){return e.some(n,t)},this.contains=function(t){return e.contains(n,t)},this.reverse=function(){return e.create(e.reverse(n))},this.map=function(t){return e.create(e.map(n,t))},this.filter=function(t){return e.create(e.filter(n,t))},this.flatten=function(){return e.create(e.flatten(n))},this.flatMap=function(t){return e.create(e.flatMap(n,t))},this.cache=function(){return e.create(e.cache(n))},null!=t&&(this.has=t.has,this.get=t.get,this.prev=t.prev,this.next=t.next)}return e.isList=function(e){return!!(null!=e&&e.has&&e.get&&e.prev&&e.next)},e.create=function(t){return new e({has:t.has,get:t.get,prev:t.prev,next:t.next})},e.first=function(e){return e.get(e.next())},e.last=function(e){return e.get(e.prev())},e.forEach=function(e,t){for(var n;null!=(n=e.next(n));)t(e.get(n),n)},e.reduce=function(e,t,n){for(var r;null!=(r=e.next(r));)n=t(n,e.get(r),r);return n},e.toArray=function(t){return e.reduce(t,function(e,t){return e.push(t),e},[])},e.findKey=function(e,t){for(var n;null!=(n=e.next(n));)if(t(e.get(n),n))return n},e.find=function(t,n){return t.get(e.findKey(t,n))},e.keyOf=function(t,n){return e.findKey(t,function(e){return e===n})},e.indexOf=function(e,t){for(var n,r=0;null!=(n=e.next(n));){if(e.get(n)===t)return r;r++}},e.keyAt=function(e,t){for(var n,r=0;null!=(n=e.next(n));)if(r++==t)return n;return null},e.at=function(t,n){return t.get(e.keyAt(t,n))},e.every=function(e,t){for(var n;null!=(n=e.next(n));)if(!t(e.get(n),n))return!1;return!0},e.some=function(e,t){for(var n;null!=(n=e.next(n));)if(t(e.get(n),n))return!0;return!1},e.contains=function(t,n){return e.some(t,function(e){return e===n})},e.reverse=function(e){function t(t){return e.next(t)}function n(t){return e.prev(t)}var r=e.has,i=e.get;return{has:r,get:i,prev:t,next:n}},e.map=function(e,t){function n(n){return r(n)?t(e.get(n),n):void 0}var r=e.has,i=e.prev,o=e.next;return{has:r,get:n,prev:i,next:o}},e.filter=function(e,t){function n(n){return e.has(n)&&t(e.get(n),n)}function r(t){return n(t)?e.get(t):void 0}function i(t){for(var r=t;null!=(r=e.prev(r));)if(n(r))return r;return null}function o(t){for(var r=t;null!=(r=e.next(r));)if(n(r))return r;return null}return{has:n,get:r,prev:i,next:o}},e.flatten=function(e){function t(t){var n=r.Path.create(t);return r.Tree.has(e,n,1)}function n(t){var n=r.Path.create(t);return r.Tree.get(e,n,1)}function i(t){var n=r.Path.create(t);return r.Path.key(r.Tree.prev(e,n,1))}function o(t){var n=r.Path.create(t);return r.Path.key(r.Tree.next(e,n,1))}return{has:t,get:n,prev:i,next:o}},e.flatMap=function(t,n){return e.flatten(e.map(t,n))},e.cache=function(e){return new i["default"](e)},e}();n.List=o,n["default"]=o},{"./cache":7,"./tree":14}],10:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./observable_list"),o=function(e){function t(n){var r=this;e.call(this,n),this.set=function(e,t){throw new Error("Not implemented")},this.splice=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];throw new Error("Not implemented")},this.addBefore=function(e,n){return t.addBefore(r,e,n)},this.addAfter=function(e,n){return t.addAfter(r,e,n)},this.push=function(e){return t.push(r,e)},this.unshift=function(e){return t.unshift(r,e)},this["delete"]=function(e){return t["delete"](r,e)},this.deleteBefore=function(e){return t.deleteBefore(r,e)},this.deleteAfter=function(e){return t.deleteAfter(r,e)},this.pop=function(){return t.pop(r)},this.shift=function(){return t.shift(r)},this.remove=function(e){return t.remove(r,e)},null!=n&&(this.set=n.set,this.splice=n.splice)}return r(t,e),t.isMutableList=function(e){return i.ObservableList.isObservableList(e)&&!!e.set&&!!e.splice},t.create=function(e){return new t({has:e.has,get:e.get,prev:e.prev,next:e.next,observe:e.observe,set:e.set,splice:e.splice})},t.addBefore=function(e,t,n){return e.splice(e.prev(t),t,n),e.prev(t)},t.addAfter=function(e,t,n){return e.splice(t,e.next(t),n),e.next(t)},t.push=function(e,n){return t.addBefore(e,null,n)},t.unshift=function(e,n){return t.addAfter(e,null,n)},t["delete"]=function(e,t){if(e.has(t)){var n=e.get(t);return e.splice(e.prev(t),e.next(t)),n}},t.deleteBefore=function(e,n){return t["delete"](e,e.prev(n))},t.deleteAfter=function(e,n){return t["delete"](e,e.next(n))},t.pop=function(e){return t.deleteBefore(e,null)},t.shift=function(e){return t.deleteAfter(e,null)},t.remove=function(e,n){var r=t.keyOf(e,n);return null==r?!1:(delete r,!0)},t}(i.ObservableList);n.MutableList=o,n["default"]=o},{"./observable_list":13}],11:[function(e,t,n){var r=e("./key"),i=function(){function e(){var e=this;this.observe=function(t){var n=r["default"].create();return e._observers[n]=t,{unsubscribe:function(){delete e._observers[n]}}},this.notify=function(t){for(var n in e._observers)t(e._observers[n])},this._observers=Object.create(null)}return e}();n.Subject=i},{"./key":8}],12:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./cache"),o=function(e){function t(t){var n=this;e.call(this,t),t.observe({onInvalidate:function(e,t){var r;for(r=e;void 0!==(r=n._next[r])&&(delete n._next[n._prev[r]],delete n._prev[r],r!=t);)delete n._byKey[r];for(;void 0!==(r=n._prev[r])&&(delete n._prev[n._next[r]],delete n._next[r],r!=e);)delete n._byKey[r]}})}return r(t,e),t.prototype.observe=function(e){return this._list.observe(e)},t}(i["default"]);n["default"]=o},{"./cache":7}],13:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./list"),o=e("./tree"),u=e("./observable"),s=e("./observable_cache"),l=function(e){function t(n){var r=this;e.call(this,n),this.observe=function(e){throw new Error("Not implemented")},this.reverse=function(){return t.create(t.reverse(r))},this.map=function(e){return t.create(t.map(r,e))},this.filter=function(e){return t.create(t.filter(r,e))},this.flatten=function(){return t.create(t.flatten(r))},this.flatMap=function(e){return t.create(t.flatMap(r,e))},this.cache=function(){return t.create(t.cache(r))},null!=n&&(this.observe=n.observe)}return r(t,e),t.isObservableList=function(e){return i.List.isList(e)&&!!e.observe},t.create=function(e){return new t({has:e.has.bind(e),get:e.get.bind(e),prev:e.prev.bind(e),next:e.next.bind(e),observe:e.observe.bind(e)})},t.reverse=function(e){function t(t){return e.observe(t)}var n=i.List.reverse(e),r=n.has,o=n.get,u=n.prev,s=n.next;return{has:r,get:o,prev:u,next:s,observe:t}},t.map=function(e,t){var n=i.List.map(e,t),r=n.has,o=n.get,u=n.prev,s=n.next;return{has:r,get:o,prev:u,next:s,observe:e.observe}},t.filter=function(e,t){function n(t){return e.observe({onInvalidate:function(e,n){e=o(e)?e:s(e),n=o(n)?n:l(n),t.onInvalidate(e,n)}})}var r=i.List.filter(e,t),o=r.has,u=r.get,s=r.prev,l=r.next;return{has:o,get:u,prev:s,next:l,observe:n}},t.flatten=function(e){var n,r=Object.create(null),s=new u.Subject;e.observe({onInvalidate:function(e,t){var i;for(i=e;null!=(i=n.next(i))&&i!=t;){var o=r[i];o&&(o.unsubscribe(),delete r[i])}for(i=t;null!=(i=n.prev(i))&&i!=e;){var o=r[i];o&&(o.unsubscribe(),delete r[i])}}}),n=t.cache(t.map(e,function(t,n){return r[n]=t.observe({onInvalidate:function(t,r){var i,u,l=o.Path.append(n,t),a=o.Path.append(n,r);null==t&&(l=o.Tree.prev(e,o.Tree.next(e,l))),null==r&&(a=o.Tree.next(e,o.Tree.prev(e,a))),i=o.Path.key(l),u=o.Path.key(a),s.notify(function(e){e.onInvalidate(i,u)})}}),t})),n.observe({onInvalidate:function(t,n){var r=o.Path.key(o.Tree.prev(e,[t])),i=o.Path.key(o.Tree.next(e,[n]));s.notify(function(e){e.onInvalidate(r,i)})}});var l=i.List.flatten(n),a=l.has,c=l.get,f=l.next,h=l.prev;return{has:a,get:c,next:f,prev:h,observe:s.observe}},t.flatMap=function(e,n){return t.flatten(t.map(e,n))},t.cache=function(e){return new s["default"](e)},t}(i.List);n.ObservableList=l,n["default"]=l},{"./list":9,"./observable":11,"./observable_cache":12,"./tree":14}],14:[function(e,t,n){var r,i=e("./list");!function(e){function t(e){return JSON.stringify(e)}function n(e){return null==e?null:JSON.parse(e.toString())}function r(e){return e?e[0]:null}function i(e,t){return e[t]}function o(e){return null==e?[]:e.slice(1,e.length)}function u(e,t){return[].concat(e).concat(t)}e.key=t,e.create=n,e.head=r,e.get=i,e.tail=o,e.append=u}(r=n.Path||(n.Path={}));var o;!function(e){function t(t,n,i){void 0===i&&(i=1/0);var o=r.head(n),u=r.tail(n);return t.has(o)&&(0==u.length||0==i||e.has(t.get(o),u,i))}function n(t,n,i){void 0===i&&(i=1/0);var o=r.head(n),u=r.tail(n);if(t.has(o)){var s=t.get(o);return 0==u.length||0==i?s:e.get(s,u,i)}}function o(t,n,o){void 0===n&&(n=[]),void 0===o&&(o=1/0);var u,s=r.head(n),l=r.tail(n),a=s;if(null==s||t.has(s))do if(u=t.get(a),i.List.isList(u)&&0!=o){var c=e.prev(u,l,o-1);if(null!=c)return r.append(a,c);l=[]}else if(null!=a&&a!=s)return[a];while(null!=(a=t.prev(a)))}function u(t,n,o){void 0===n&&(n=[]),void 0===o&&(o=1/0);var u,s=r.head(n),l=r.tail(n),a=s;if(null==s||t.has(s))do if(u=t.get(a),i.List.isList(u)&&0!=o){var c=e.next(u,l,o-1);if(null!=c)return r.append(a,c);l=[]}else if(null!=a&&a!=s)return[a];while(null!=(a=t.next(a)))}e.has=t,e.get=n,e.prev=o,e.next=u}(o=n.Tree||(n.Tree={})),n["default"]=o},{"./list":9}],15:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./key"),o=e("./observable"),u=e("./mutable_list"),s=function(e){function t(t){var n=this;e.call(this),this.has=function(e){return n._key==e},this.get=function(e){return n.has(e)?n._value:void 0},this.prev=function(e){return null==e?n._key:null},this.next=function(e){return null==e?n._key:null},this.set=function(e,t){n._key=e,n._value=t,n._invalidate()},this.splice=function(e,t){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return r.length?n.set(i["default"].create(),r[0]):(delete n._key,delete n._value,void n._invalidate())},this.observe=function(e){return n._subject.observe(e)},this._invalidate=function(e,t){n._subject.notify(function(n){n.onInvalidate(e,t)})},this._subject=new o.Subject,arguments.length&&this.splice(null,null,t)}return r(t,e),t}(u.MutableList);n["default"]=s},{"./key":8,"./mutable_list":10,"./observable":11}],16:[function(e,t,n){arguments[4][7][0].apply(n,arguments)},{dup:7}],17:[function(e,t,n){arguments[4][8][0].apply(n,arguments)},{dup:8}],18:[function(e,t,n){var r=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},i=e("./key"),o=e("./observable"),u=e("./mutable_list"),s=function(e){function t(t,n){var r=this;e.call(this),this._keyFn=i["default"].create,this.has=function(e){return e in r._byKey},this.get=function(e){return r._byKey[e]},this.prev=function(e){void 0===e&&(e=null);var t=r._prev[e];return null==t?null:t},this.next=function(e){void 0===e&&(e=null);var t=r._next[e];return null==t?null:t},this.set=function(e,t){return r.has(e)?(r._byKey[e]=t,r._invalidate(r._prev[e],r._next[e]),e):null},this.splice=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o,u;for(o=e;null!=(o=r._next[o])&&(delete r._next[r._prev[o]],delete r._prev[o],o!=t);)delete r._byKey[o];for(o=t;null!=(o=r._prev[o])&&(delete r._prev[r._next[o]],delete r._next[o],o!=e);)delete r._byKey[o];for(var s=e,l=0;l<n.length;l++)u=n[l],o=r._keyFn(u),r._byKey[o]=u,r._prev[o]=s,r._next[s]=o,s=o;r._prev[t]=s,r._next[s]=t,r._invalidate(e,t)},this.observe=function(e){return r._subject.observe(e)},this._invalidate=function(e,t){r.has(e)||(e=null),r.has(t)||(t=null),r._subject.notify(function(n){n.onInvalidate(e,t)})},n&&(this._keyFn=n),this._subject=new o.Subject,this._byKey=Object.create(null),this._prev=Object.create(null),this._next=Object.create(null),this._prev[null]=null,this._next[null]=null,this.splice.apply(this,[null,null].concat(t))}return r(t,e),t}(u.MutableList);n["default"]=s},{"./key":17,"./mutable_list":20,"./observable":21}],19:[function(e,t,n){arguments[4][9][0].apply(n,arguments)},{"./cache":16,"./tree":24,dup:9}],20:[function(e,t,n){arguments[4][10][0].apply(n,arguments)},{"./observable_list":23,dup:10}],21:[function(e,t,n){arguments[4][11][0].apply(n,arguments)},{"./key":17,dup:11}],22:[function(e,t,n){arguments[4][12][0].apply(n,arguments)},{"./cache":16,dup:12}],23:[function(e,t,n){arguments[4][13][0].apply(n,arguments)},{"./list":19,"./observable":21,"./observable_cache":22,"./tree":24,dup:13}],24:[function(e,t,n){arguments[4][14][0].apply(n,arguments)},{"./list":19,dup:14}],25:[function(e,t,n){var r,i=e("./model");!function(e){e.Model=i["default"]}(r||(r={})),t.exports=r},{"./model":1}]},{},[25])(25)});