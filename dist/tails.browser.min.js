!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Tails=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){(function(){var c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};g=a("../mixable"),d=a("../mixins/collectable"),e=a("../mixins/debug"),f=a("../mixins/dynamic_attributes"),c=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return i(c,b),_.extend(c,g),c.concern(e),c.concern(f),c.concern(d),c.prototype.relations=function(){var b,c;return b=a("../collection"),c=a("./relation"),null==this._relations&&(this._relations=new b([],{model:c})),this._relations},c.prototype.apply=function(b){var c,d,e,f,g,h,i;switch(c=a("./belongs_to_relation"),e=a("./has_one_relation"),d=a("./has_many_relation"),f={association:this,from:this.get("from"),to:this.get("to"),name:this.get("name"),owner:b},this.get("type")){case"belongsTo":g=b.get(f.name),i=new c(_.extend(f,{foreignKey:this.get("foreignKey")||inflection.foreign_key(f.to.name||f.to.toString().match(/^function\s*([^\s(]+)/)[1])})),null!=g&&i.set("target",g);break;case"hasOne":g=b.get(f.name),i=new e(_.extend(f,{foreignKey:this.get("foreignKey")||inflection.foreign_key(f.from.name||f.from.toString().match(/^function\s*([^\s(]+)/)[1]),through:this.get("through"),source:this.get("source")||this.get("name")})),null!=g&&i.set("target",g);break;case"hasMany":h=b.get(f.name),i=new d(_.extend(f,{foreignKey:this.get("foreignKey")||inflection.foreign_key(f.from.name||f.from.toString().match(/^function\s*([^\s(]+)/)[1]),through:this.get("through"),source:this.get("source")||this.get("name")})),null!=h&&i.set("target",h)}return this.relations().add(i),b.relations().add(i),b.getter(f.name,function(){return i.get("target")}),b.setter(f.name,function(a){return i.set("target",a)})},c}(Backbone.Model),b.exports=c}).call(this)},{"../collection":6,"../mixable":8,"../mixins/collectable":10,"../mixins/debug":11,"../mixins/dynamic_attributes":12,"./belongs_to_relation":2,"./has_many_relation":3,"./has_one_relation":4,"./relation":5}],2:[function(a,b){(function(){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("./relation"),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.initialize=function(){var a,c,d,e;return a=this.get("association"),e=a.get("to"),c=this.get("foreignKey"),d=this.get("owner"),this.getter({target:function(){return e.get(d.get(c))}}),this.setter({target:function(a){return null==a?void this.set(c,null):(null==e.all().get(a.id)&&e.all().add(a,{parse:!0}),d.set(c,a.id))}}),b.__super__.initialize.apply(this,arguments)},b}(d),b.exports=c}).call(this)},{"./relation":5}],3:[function(a,b){(function(){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("./relation"),c=a("../collection"),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype.initialize=function(){var a,b,d,e,f,g,h,i,j,k;return a=this.get("association"),k=a.get("to"),f=this.get("owner"),e=this.get("name"),d=this.get("foreignKey"),i=this.get("through"),g=this.get("source"),null==i?(b=k.all().where(d).is(f.id),b.parent=f,this.getter({target:function(){return function(){return b}}(this)}),this.setter({target:function(){return function(a){return b.each(function(a){return a.unset(d)}),b.add(a)}}(this)})):(j=f.constructor.associations().findWhere({name:i}),"hasMany"!==j.get("type")?this.getter({target:function(){return function(){return f.get(i).get(g||e)}}(this)}):(h=g&&j.get("to").associations().findWhere({name:g})||j.get("to").associations().findWhere({name:e,type:"hasMany"})||j.get("to").associations().findWhere({name:inflection.singularize(e)}),"hasMany"===h.get("type")?(g=h.get("name"),this.lazy({target:function(){var a;return a=new c.Union,a.parent=f,f.get(i).each(function(){return function(b){return a.addCollection(b.get(g))}}(this)),f.get(i).on("add",function(){return function(b){return a.addCollection(b.get(g))}}(this)),f.get(i).on("remove",function(){return function(b){return a.removeCollection(b.get(g))}}(this)),a}})):(g=h.get("name"),this.lazy({target:function(){return f.get(i).pluck(g)}}))))},b}(e),b.exports=d}).call(this)},{"../collection":6,"./relation":5}],4:[function(a,b){(function(){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("./relation"),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return f(b,a),b.prototype.initialize=function(){var a,c,d,e,f,g;return d=this.get("owner"),a=this.get("association"),g=a.get("to"),c=this.get("foreignKey"),f=this.get("through"),e=this.get("source"),null==f?(this.getter({target:function(){return function(){return g.all().where(c).is(d.id).first()}}(this)}),this.setter({target:function(){return function(a){var b;return null!=(b=g.all().where(c).is(d.id).first())&&b.unset(c),a.set(c,d.id)}}(this)})):(this.getter({target:function(){return function(){return d.get(f).get(e)}}(this)}),this.setter({target:function(){return function(a){return d.get(f).set(e,a)}}(this)})),b.__super__.initialize.apply(this,arguments)},b}(d),b.exports=c}).call(this)},{"./relation":5}],5:[function(a,b){(function(){var c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("../mixable"),d=a("../mixins/dynamic_attributes"),c=a("../mixins/collectable"),f=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),_.extend(b,e),b.concern(d),b.concern(c),b.prototype.initialize=function(){},b}(Backbone.Model),b.exports=f}).call(this)},{"../mixable":8,"../mixins/collectable":10,"../mixins/dynamic_attributes":12}],6:[function(a,b){(function(){var c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=[].slice,j=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};d=a("./mixable"),e=a("./model"),f=a("./config"),c=function(a){function b(a,c){null==a&&(a=[]),null==c&&(c={}),this.model=c.model||this.model||e,this.parent=c.parent||this.parent,this.synced=c.synced||!1,this.on("change",function(a){return function(){return a.synced=!1}}(this)),this.on("sync",function(a){return function(){return a.synced=!0,a.syncedAt=Date.now()}}(this)),b.__super__.constructor.apply(this,arguments)}return h(b,a),_.extend(b,d),b.prototype.syncedAt=0,b.prototype.urlRoot=function(){return inflection.transform(this.model.name||this.model.toString().match(/^function\s*([^\s(]+)/)[1],["underscore","pluralize"])},b.prototype.url=function(){var a,b,c,d,e,g;return a=(null!=(e=this.parent)&&"function"==typeof e.url?e.url():void 0)||(null!=(g=this.parent)?g.url:void 0)||f.url,c=("function"==typeof this.urlRoot?this.urlRoot():void 0)||this.urlRoot,b=null!=this.format?"."+(("function"==typeof this.format?this.format():void 0)||this.format):"",d=""+a+"/"+c+b},b.prototype.fetch=function(a){var c,d,e,f;if(null==a&&(a={}),!a.force){if(this.syncing)return this._fetchPromise;if(this.synced)return c=Q.defer(),c.resolve(),c.promise}return a.dataType||(a.dataType=this.format),d=b.__super__.fetch.call(this,a),this.synced=!1,this.syncing=!0,c=Q.defer(),f=function(a){return function(){var b;return b=1<=arguments.length?i.call(arguments,0):[],a.syncing=!1,c.resolve.apply(c,b)}}(this),e=function(a){return function(){var b;return b=1<=arguments.length?i.call(arguments,0):[],a.syncing=!1,c.reject.apply(c,b)}}(this),d.then(function(a){return function(){var b;return b=1<=arguments.length?i.call(arguments,0):[],a.synced?f.apply(null,b):a.once("sync",function(){return f.apply(null,b)})}}(this)),d.fail(function(){return function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],e.apply(null,a)}}(this)),this._fetchPromise=c.promise},b.prototype.filter=function(a){return new b.Filtered(this,{filter:a})},b.prototype.where=function(a,c){var d,e,f,g,h;return null!=c?b.__super__.where.call(this,a,c):"object"==typeof a?(f=function(b){var c,d;for(c in a)if(d=a[c],b.get(c)!==d)return!1;return!0},d=function(b){var c,d,e;e=[];for(c in a)d=a[c],e.push(b.set(c,d));return e},e=function(b){var c,d,e;e=[];for(c in a)d=a[c],e.push(b.unset(c));return e},new b.Filtered(this,{filter:f,assimilate:d,distantiate:e})):"string"==typeof a?(g=a,h={is:function(a){return function(b){var c,d,e,f;return(c={})[g]=b,(d=(e=(f=a._where||(a._where={}))[g]||(f[g]={})).is||(e.is={}))[b]||(d[b]=a.where(c))}}(this),"in":function(a){return function(b){return a.filter(function(a){var c;return c=a.get(g),j.call(b,c)>=0})}}(this),atLeast:function(a){return function(b){return a.filter(function(a){return a.get(g)>=b})}}(this),atMost:function(a){return function(b){return a.filter(function(a){return a.get(g)<=b})}}(this),greaterThan:function(a){return function(b){return a.filter(function(a){return a.get(g)>b})}}(this),lessThan:function(a){return function(b){return a.filter(function(a){return a.get(g)<b})}}(this)}):void 0},b.prototype.pluck=function(a){return new b.Plucked(this,{attribute:a})},b.prototype.parse=function(a){var b,c,d,e,f;for(a instanceof Array||(a=[a]),d=[],e=0,f=a.length;f>e;e++){if(b=a[e],b instanceof Backbone.Model){d.push(b);break}c=this.model.get(b.id),c.set(b),d.push(c)}return d},b}(Backbone.Deferred.Collection),c.Plucked=function(a){function b(a,c){null==c&&(c={}),this.collection=a,this.attribute=c.attribute,this.length=0,b.__super__.constructor.call(this,[],c),this.collection.each(function(a){return function(b){return a.trigger("add",b.get(a.attribute))}}(this)),this.listenTo(a,"change:"+this.attribute,function(a){return function(b){var c,d;return d=b.get(a.attribute),c=b.previous(a.attribute),null!=c&&a.trigger("remove",c),null!=d?a.trigger("add",d):void 0}}(this)),this.listenTo(a,"add",function(a){return function(b){var c;return c=b.get(a.attribute),null!=c&&a.trigger("add",c),a.length++}}(this)),this.listenTo(a,"remove",function(a){return function(b){var c;return c=b.get(a.attribute),null!=c&&a.trigger("remove",c),a.length--}}(this))}return h(b,a),b.prototype.contains=function(a){return j.call(this.toArray(),a)>=0},b.prototype.include=function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],this.contains.apply(this,a)},b.prototype.each=function(a){return this.collection.each(function(b){return function(c){return a(c.get(b.attribute))}}(this))},b.prototype.forEach=function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],this.each.apply(this,a)},b.prototype.toArray=function(){var a;return function(){var b,c,d,e;for(d=this.collection.toArray(),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.get(this.attribute));return e}.call(this)},b}(c),c.Filtered=function(a){function b(a,c){null==c&&(c={}),this.collection=a,this.model=this.collection.model,this.filter=c.filter,this.assimilate=c.assimilate,this.distantiate=c.distantiate,b.__super__.constructor.call(this,[],c),this.collection.each(function(a){return function(b){return a.filter(b)?a.add(b):void 0}}(this)),this.listenTo(this.collection,"add",function(a){return function(b){return a.filter(b)?a.add(b):void 0}}(this)),this.listenTo(this.collection,"remove",function(a){return function(b){return a.remove(b)}}(this)),this.listenTo(this.collection,"change",function(a){return function(b){return a.filter(b)?a.add(b):a.remove(b)}}(this)),this.on("add",function(a){return function(b){if(!a.filter(b)){if(null==a.assimilate)throw a.remove(b),Error("Cannot assimilate model.");return a.assimilate(b),a.collection.add(b)}}}(this)),this.on("remove",function(a){return function(b){if(a.collection.contains(b)&&a.filter(b)){if(null==a.distantiate)throw a.add(b),Error("Cannot distantiate model.");return a.distantiate(b)}}}(this))}return h(b,a),b}(c),c.Multi=function(a){function b(a,c){var d,e,f;for(null==a&&(a=[]),null==c&&(c={}),this.collections=[],this.modelCounts={},b.__super__.constructor.call(this,[],c),e=0,f=a.length;f>e;e++)d=a[e],this.addCollection(d)}return h(b,a),b.prototype.increment=function(a){var b,c;return(b=this.modelCounts)[c=a.cid]||(b[c]=0),++this.modelCounts[a.cid]},b.prototype.decrement=function(a){var b,c;return(b=this.modelCounts)[c=a.cid]||(b[c]=0),--this.modelCounts[a.cid]},b.prototype.addCollection=function(a){return a instanceof Backbone.Collection?(this.model||(this.model=a.model),this.collections.push(a),a.each(function(a){return function(b){return a.increment(b)}}(this)),this.listenTo(a,"add",this.increment),this.listenTo(a,"remove",this.decrement),this.trigger("addCollection",a)):void 0},b.prototype.removeCollection=function(a){var b;if(a instanceof Backbone.Collection&&(b=this.collections.indexOf(a),b>=0))return this.collections=this.collections.slice(0,b).concat(this.collections.slice(b+1,this.collections.length)),a.each(function(a){return function(b){return a.decrement(b)}}(this)),this.stopListening(a),this.trigger("removeCollection",a)},b}(c),c.Union=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.increment=function(a){return 1===b.__super__.increment.apply(this,arguments)?this.add(a):void 0},b.prototype.decrement=function(a){return 0===b.__super__.decrement.apply(this,arguments)?this.remove(a):void 0},b}(c.Multi),b.exports=c}).call(this)},{"./config":7,"./mixable":8,"./model":16}],7:[function(a,b){(function(){b.exports={url:"http://localhost"}}).call(this)},{}],8:[function(a,b){(function(){var a,c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},d=[].slice;a={MixableKeywords:["included","extended","constructor","Interactions","InstanceMethods","ClassMethods"],_include:function(a){var b,d,e,f;if(null!=a.InstanceMethods)b=a.InstanceMethods;else{if(null!=a.ClassMethods)return;b=a}for(d in b)e=b[d],c.call(this.MixableKeywords,d)<0&&null!=e&&(this.prototype[d]=e);return null!=(f=b.included)?f.apply(this):void 0},_extend:function(a){var b,d,e,f;if(null!=a.ClassMethods)b=a.ClassMethods;else{if(null!=a.InstanceMethods)return;b=a}for(d in b)e=b[d],c.call(this.MixableKeywords,d)<0&&null!=e&&(this[d]=e);return null!=(f=b.extended)?f.apply(this):void 0},include:function(){var a,b,e,f,g,h,i,j,k;for(e=1<=arguments.length?d.call(arguments,0):[],(null!=(j=this._includedMixins)?j.klass:void 0)!==this&&(this._includedMixins=_(this._includedMixins).clone()||[],this._includedMixins.klass=this),f=0,h=e.length;h>f;f++)b=e[f],c.call(this._includedMixins,b)>=0||(null!=b&&this._includedMixins.push(b),this._include(b),null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._include(a)));for(k=this._includedMixins,g=0,i=k.length;i>g;g++)b=k[g],null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._include(a));return this},extend:function(){var a,b,e,f,g,h,i,j,k;for(e=1<=arguments.length?d.call(arguments,0):[],(null!=(j=this._extendedMixins)?j.klass:void 0)!==this&&(this._extendedMixins=_(this._extendedMixins).clone()||[],this._extendedMixins.klass=this),f=0,h=e.length;h>f;f++)b=e[f],c.call(this._extendedMixins,b)>=0||(null!=b&&this._extendedMixins.push(b),this._extend(b),null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._extend(a)));for(k=this._extendedMixins,g=0,i=k.length;i>g;g++)b=k[g],null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._extend(a));return this},"with":function(a,b){return null==b&&(b={}),null!=this._includedMixins&&c.call(this._includedMixins,a)>=0?b:null!=this._extendedMixins&&c.call(this._extendedMixins,a)>=0?b:null},concern:function(){var a,b,c,e;for(b=1<=arguments.length?d.call(arguments,0):[],c=0,e=b.length;e>c;c++)a=b[c],this.include(a),this.extend(a);return this}},b.exports=a}).call(this)},{}],9:[function(a,b){(function(){var c,d,e;e=a("../associations/relation"),d=a("../associations/association"),c={InstanceMethods:{relations:function(){var b;return b=a("../collection"),null==this._relations&&(this._relations=new b([],{model:e})),this._relations}},ClassMethods:{belongsTo:function(a){return this.associate("belongsTo",a)},hasOne:function(a){return this.associate("hasOne",a)},hasMany:function(a){return this.associate("hasMany",a)},associate:function(a,b){var c,e,f,g;return f=_(b).keys()[0],g=b[f],e={type:a,from:this,name:f,foreignKey:b.foreignKey,through:b.through,source:b.source},c=new d(e),g.prototype instanceof Backbone.Model?c.set({to:g}):c.getter({to:g})},associations:function(){var a;return(null!=(a=this._associations)?a.klass=this:void 0)||(this._associations=d.all().where({from:this}),this._associations.klass=this),this._associations},extended:function(){var b,c,d;return c=a("./dynamic_attributes"),b=a("./collectable"),d=a("./interceptable"),this.concern(c),this.concern(b),this.concern(d),this.before({initialize:function(){return this.constructor.associations().each(function(a){return function(b){return b.apply(a)}}(this))}})}}},b.exports=c}).call(this)},{"../associations/association":1,"../associations/relation":5,"../collection":6,"./collectable":10,"./dynamic_attributes":12,"./interceptable":14}],10:[function(a,b){(function(){var c,d;d=a("./interceptable"),c={InstanceMethods:{included:function(){return this.concern(d),this.after({initialize:function(){if(null!=this.id&&null!=this.constructor.all().get(this.id))throw new Error("Duplicate "+this.constructor.name+" for id "+this.id+".");return this.constructor.all().add(this)}})}},ClassMethods:{all:function(){var b,c;return b=a("../collection"),(null!=(c=this._all)?c.klass:void 0)!==this&&(this._all=new b(null,{model:this}),this._all.klass=this),this._all},get:function(a){return this.all().get(a)||new this({id:a})},scope:function(a,b){return this[a]=this.all().where(b.where)}},Interactions:function(){var b;return b=a("./storage"),{ClassMethods:this["with"](b,{extended:function(){return this.all().on("add remove",function(a){return function(b){return null!=b.id?a.store():void 0}}(this))}})}}},b.exports=c}).call(this)},{"../collection":6,"./interceptable":14,"./storage":15}],11:[function(a,b){(function(){var c,d,e=[].slice,f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};d=a("./interceptable"),c={InstanceMethods:{LOG_LEVELS:{ERROR:!0,WARNING:!0,INFO:!1},_excludedMethods:_.union(Object.keys(d.InstanceMethods),["constructor","log","message","warn","error","info"]),debug:function(){return this.LOG_LEVELS.INFO=!0},message:function(){var a,b,c,d,f;for(c=1<=arguments.length?e.call(arguments,0):[],a=""+new Date+" - ",d=0,f=c.length;f>d;d++)b=c[d],a+="String"===b.constructor.name?b+" ":JSON.stringify(b)+" ";return a+="in "+this.constructor.name+"("+this.id+")"},error:function(){var a,b;return b=1<=arguments.length?e.call(arguments,0):[],this.LOG_LEVELS.ERROR?(a=this.message.apply(this,b),console.error(a)):void 0},warn:function(){var a,b;return b=1<=arguments.length?e.call(arguments,0):[],this.LOG_LEVELS.WARNING?(a=this.message.apply(this,b),console.warn(a)):void 0},log:function(){var a,b;return b=1<=arguments.length?e.call(arguments,0):[],a=this.message.apply(this,b),console.log(a)},info:function(){var a,b;return b=1<=arguments.length?e.call(arguments,0):[],this.LOG_LEVELS.INFO?(a=this.message.apply(this,b),console.log(a)):void 0},included:function(){return this.concern(d),this.after({initialize:function(){var a,b,c,d,g,h,i;for(a=1<=arguments.length?e.call(arguments,0):[],this.info("Called function 'initialize' of "+this.constructor.name+" with arguments:",a),this.on("change",function(a){return function(b){return a.info("Change of attributes:",b.changedAttributes())}}(this)),b=function(){var a;a=[];for(c in this)d=this[c],d instanceof Function&&f.call(this._excludedMethods,c)<0&&a.push(c);return a}.call(this),i=[],g=0,h=b.length;h>g;g++)c=b[g],i.push(function(a){return function(b){return a.after({these:[b],"do":function(){var a;return a=1<=arguments.length?e.call(arguments,0):[],this.info("Called function '"+b+"' of "+this.constructor.name+" with arguments:",a)}})}}(this)(c));return i}})}}},b.exports=c}).call(this)},{"./interceptable":14}],12:[function(a,b){(function(){var c,d;d=a("./interceptable"),c={InstanceMethods:{getter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.defineAttribute({getter:a})},setter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.defineAttribute({setter:a})},lazy:function(a,b){var c,d,e;null==b&&(b=null),"string"==typeof a&&null!=b&&(d=a,(a={})[d]=b),e=[];for(c in a)b=a[c],e.push(function(a){return function(b,c){return a.getter(b,function(){return a.attributes[b]=(a[c]||c).call(a)}),a.setter(b,function(c){return delete a.attributes[b],a.attributes[b]=c})}}(this)(c,b));return e},defineAttribute:function(a){var b,c,d,e,f;f=[];for(e in a)b=a[e],("getter"===e||"setter"===e)&&f.push(function(){var a;a=[];for(d in b)c=b[d],a.push(function(a){return function(b,c){var d;return d=Object.getOwnPropertyDescriptor(a.attributes,b)||{configurable:!0},delete a.attributes[b],delete d.value,delete d.writable,"getter"===e?d.get=function(){return(a[c]||c).call(a)}:"setter"===e&&(d.set=function(b){var d;return d=(a[c]||c).call(a,b)}),Object.defineProperty(a.attributes,b,d)}}(this)(d,c));return a}.call(this));return f}},ClassMethods:{getter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.before({initialize:function(){return this.getter(a)}})},setter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.before({initialize:function(){return this.setter(a)}})},lazy:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.before({initialize:function(){return this.lazy(a)}})},extended:function(){return this.concern(d)}}},b.exports=c}).call(this)},{"./interceptable":14}],13:[function(a,b){(function(){var c,d;d=a("./storage"),c={Interactions:function(){return{InstanceMethods:this["with"](d,{diff:function(){var a,b,c,d,e;a={},a.apply=function(b){return function(c){var d,e,f,g;null==c&&(c=b);for(e in a){d=a[e];for(f in d)switch(g=d[f],f){case"create":c.set(e,g.value);break;case"update":c.set(e,g["new"]);break;case"delete":c.unset(e)}}return c}}(this),c=this.constructor.retrieve(this.id)||{},e=this.attributes;for(b in e)d=e[b],c[b]!==this.get(b)&&(a[b]=null!=c[b]?{update:{old:c[b],"new":this.get(b)}}:{create:{value:this.get(b)}});for(b in c)d=c[b],this.has(b)||(a[b]={"delete":{value:d}});return a},commit:function(){var a;return a=this.store(this.diff())},included:function(){return this.after({initialize:function(){return this.on("change",this.commit)}})}})}}},b.exports=c}).call(this)},{"./storage":15}],14:[function(a,b){(function(){var a,c=[].slice;a={InstanceMethods:{before:function(a){return this.intercept({before:a})},after:function(a){return this.intercept({after:a})},intercept:function(a){var b,d,e,f,g,h,i,j,k,l,m,n;h=this.constructor,n=[];for(i in a)if(e=a[i],"before"===i||"after"===i){if(null!=e.these)for(m=e.these,k=0,l=m.length;l>k;k++){if(g=m[k],"function"==typeof g)for(f in this)if(j=this[f],g===j){g=f;break}e[g]=e["do"]}e=_(e).omit("these","do"),n.push(function(){var a;a=[];for(g in e)d=e[g],_(d).isArray()||(d=[d]),a.push(function(){var a,e,f;for(f=[],a=0,e=d.length;e>a;a++)b=d[a],f.push(function(a){return function(b,d){var e,f,g,j,k,l,m,n;return(a.hasOwnProperty(b)||h.prototype.hasOwnProperty(b))&&null==a[b].before&&null==a[b].after?(g=a[b],a[b]=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],"before"===i&&(this[d]||d).apply(this,a),b=g.apply(this,a),"after"===i&&(this[d]||d).apply(this,a),b}):(f=(null!=(k=a[b])?k.klass:void 0)===h&&null!=(l=a[b])?l.before:void 0,e=(null!=(m=a[b])?m.klass:void 0)===h&&null!=(n=a[b])?n.after:void 0,"before"===i?(j=f,f=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],null!=j&&j.apply(this,a),(this[d]||d).apply(this,a)}):"after"===i&&(j=e,e=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],(this[d]||d).apply(this,a),null!=j?j.apply(this,a):void 0}),Object.defineProperty(a,b,{configurable:!0,set:function(a){return Object.defineProperty(this,b,{writable:!0,value:function(){var b,d;return b=1<=arguments.length?c.call(arguments,0):[],null!=f&&f.apply(this,b),d=a.apply(this,b),null!=e&&e.apply(this,b),d}})},get:function(){var a;return a=function(){var a,d,g,i;return a=1<=arguments.length?c.call(arguments,0):[],null!=f&&f.apply(this,a),g=null!=(i=this.constructor.__super__)?i[b]:void 0,(null!=g?g.klass:void 0)!==h&&(d=null!=g?g.apply(this,a):void 0),null!=e&&e.apply(this,a),d},a.before=f,a.after=e,a.klass=h,a}}))}}(this)(g,b));return f}.call(this));return a}.call(this))}return n}},ClassMethods:{before:function(a){return null!=("function"==typeof a?a():void 0)?this.before({initialize:function(){return this.before(a.call(this))}}):this.prototype.before(a)},after:function(a){return null!=("function"==typeof a?a():void 0)?this.before({initialize:function(){return this.after(a.call(this))}}):this.prototype.after(a)}}},b.exports=a}).call(this)},{}],15:[function(a,b){(function(){var c,d,e,f,g;f=a("./interceptable"),e=a("../utils/hash"),d=a("./debug"),c=a("./collectable"),g={InstanceMethods:{storage:function(){return this.constructor.storage()},indexRoot:function(){return this.constructor.indexRoot()},store:function(a){return this.constructor.store(this,a)},retrieve:function(a){return _.defaults(this.attributes,this.constructor.retrieve(this.id,a))},included:function(){return this.concern(f),this.after({initialize:function(){return this.on("sync",this.store),this.retrieve(),this.store()}})}},ClassMethods:{storage:function(){return localStorage},toJSON:function(a){return JSON.stringify(a)},indexRoot:function(){return inflection.transform(this.name,["underscore","pluralize"])},store:function(a,b){var c,d,f,g;if(null!=a&&null!=a.id)return c=null!=(g="function"==typeof this.indexRoot?this.indexRoot():void 0)?g:this.indexRoot,f=""+c+"/"+a.id,null!=b?(f+="/"+e(this.toJSON(b)),d=this.toJSON({instance:a,data:b})):d=this.toJSON(a),this.storage().setItem(f,d),f},retrieve:function(a,b){var c,d,f,g,h,i,j;if(d=null!=(j="function"==typeof this.indexRoot?this.indexRoot():void 0)?j:this.indexRoot,null==a){if(f=this.storage().getItem(e(d)),c=JSON.parse(f),null!=f)for(h=0,i=c.length;i>h;h++)a=c[h],this.retrieve(a);return c}return g=""+d+"/"+a,null!=b&&(g+="/"+b),f=this.storage().getItem(g),null!=f?JSON.parse(f):void 0}},Interactions:function(){return{InstanceMethods:this["with"](d,{included:function(a){return function(){return a.after({initialize:function(){return console.log(this.toJSON(this.name)),this.after({store:function(){return this.log("Stored instances",this.constructor.all().pluck("id"))}})}})}}(this)}),ClassMethods:this["with"](c,{indexRoot:function(){var a;return null!=(a="function"==typeof this.urlRoot?this.urlRoot():void 0)?a:this.urlRoot},extended:function(){return this.after({store:function(){var a,b,c;return b=null!=(c="function"==typeof this.indexRoot?this.indexRoot():void 0)?c:this.indexRoot,a=this.toJSON(this.constructor.all().pluck("id")),this.constructor.storage().setItem(b,a)}})}})}}},b.exports=g}).call(this)},{"../utils/hash":19,"./collectable":10,"./debug":11,"./interceptable":14}],16:[function(a,b){(function(){var c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=[].slice;d=a("./mixable"),c=a("./mixins/associable"),f=a("./config"),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),_.extend(b,d),b.concern(c),b.prototype.syncedAt=0,b.prototype.initialize=function(a,c){var d;return null==a&&(a={}),null==c&&(c={}),this.parent=c.parent||this.parent||(null!=(d=this.collection)?d.parent:void 0),this.synced=c.synced||!1,this.on("change",function(a){return function(){return a.synced=!1}}(this)),this.on("sync",function(a){return function(){return a.synced=!0,a.syncedAt=Date.now()}}(this)),b.__super__.initialize.apply(this,arguments)},b.prototype.urlRoot=function(){return inflection.transform(this.constructor.name||this.constructor.toString().match(/^function\s*([^\s(]+)/)[1],["underscore","pluralize"])},b.prototype.url=function(){var a,b,c,d,e,g,h;return a=(null!=(g=this.parent)&&"function"==typeof g.url?g.url():void 0)||(null!=(h=this.parent)?h.url:void 0)||f.url,d=("function"==typeof this.urlRoot?this.urlRoot():void 0)||this.urlRoot,c=this.id?"/"+this.id:"",b=null!=this.format?"."+(("function"==typeof this.format?this.format():void 0)||this.format):"",e=""+a+"/"+d+c+b},b.prototype.fetch=function(a){var c,d,e,f;if(null==a&&(a={}),!a.force){if(this.syncing)return this._fetchPromise;if(this.synced)return c=Q.defer(),c.resolve(),c.promise}return a.dataType||(a.dataType=this.format),d=b.__super__.fetch.call(this,a),this.synced=!1,this.syncing=!0,c=Q.defer(),f=function(a){return function(){var b;return b=1<=arguments.length?i.call(arguments,0):[],a.syncing=!1,c.resolve.apply(c,b)}}(this),e=function(a){return function(){var b;return b=1<=arguments.length?i.call(arguments,0):[],a.syncing=!1,c.reject.apply(c,b)}}(this),d.then(function(a){return function(){var b;return b=1<=arguments.length?i.call(arguments,0):[],a.synced?f.apply(null,b):a.once("sync",function(){return f.apply(null,b)})}}(this)),d.fail(function(){return function(){var a;return a=1<=arguments.length?i.call(arguments,0):[],e.apply(null,a)}}(this)),this._fetchPromise=c.promise},b.prototype.save=function(a){return null==a&&(a={}),b.__super__.save.call(this,_.defaults(a,{dataType:this.format}))},b}(Backbone.Deferred.Model),b.exports=e}).call(this)},{"./config":7,"./mixable":8,"./mixins/associable":9}],17:[function(a,b){(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a("./utils/rivets-tails"),l=a("./utils/hash"),o=a("./mixable"),n=a("./mixins/interceptable"),h=a("./mixins/debug"),i=a("./mixins/dynamic_attributes"),f=a("./mixins/collectable"),c=a("./mixins/associable"),r=a("./mixins/storage"),m=a("./mixins/history"),g=a("./collection"),d=a("./associations/association"),q=a("./associations/relation"),e=a("./associations/belongs_to_relation"),k=a("./associations/has_one_relation"),j=a("./associations/has_many_relation"),p=a("./model"),t=a("./template"),u=a("./view"),v=a("./config"),s={Mixins:{},Utils:{},Associations:{},Models:{},Views:{}},s.Utils={Hash:l},s.Mixable=o,s.Mixins={Interceptable:n,Collectable:f,Associable:c,Debug:h,DynamicAttributes:i,Storage:r,History:m},s.Collection=g,s.Associations={Relation:q,Association:d,BelongsToRelation:e,HasOneRelation:k,HasManyRelation:j},s.Model=p,s.View=u,s.Template=t,s.config=v,b.exports=s}).call(this)},{"./associations/association":1,"./associations/belongs_to_relation":2,"./associations/has_many_relation":3,"./associations/has_one_relation":4,"./associations/relation":5,"./collection":6,"./config":7,"./mixable":8,"./mixins/associable":9,"./mixins/collectable":10,"./mixins/debug":11,"./mixins/dynamic_attributes":12,"./mixins/history":13,"./mixins/interceptable":14,"./mixins/storage":15,"./model":16,"./template":18,"./utils/hash":19,"./utils/rivets-tails":20,"./view":21}],18:[function(a,b){(function(){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a
}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("./mixins/collectable"),d=a("./model"),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),b.concern(c),b.prototype.urlRoot="assets",b.prototype.format="html",b.prototype.bind=function(a){return this.fetch({parse:!0}).then(function(b){return function(){var c;return c=$(b.get("html")).clone(),rivets.bind(c,a),c}}(this))},b.prototype.parse=function(a){return{html:a}},b}(d),b.exports=c}).call(this)},{"./mixins/collectable":10,"./model":16}],19:[function(a,b){(function(){var a;a=function(a){var b,c,d,e,f;if(c=0,0===a.length)return c;for(d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e)b=a.charCodeAt(d),c=(c<<5)-c+b,c&=c;return c},b.exports=a}).call(this)},{}],20:[function(){(function(){"undefined"!=typeof rivets&&null!==rivets&&(rivets.adapters[":"]={subscribe:function(a,b,c){return a instanceof Backbone.Collection&&a.on("add remove reset",c),a.on("change:"+b,c)},unsubscribe:function(a,b,c){return a instanceof Backbone.Collection&&a.off("add remove reset",c),a.off("change:"+b,c)},read:function(a,b){return a instanceof Backbone.Collection?a.models:a.get(b)},publish:function(a,b,c){return a.set(b,c)}})}).call(this)},{}],21:[function(a,b){(function(){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("./mixable"),d=a("./template"),e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return g(b,a),_.extend(b,c),b.prototype.initialize=function(a){return null==a&&(a={}),this.template.constructor===String&&(this.template=d.get(this.template)),this.template.bind(this).then(function(a){return function(b){return a.setElement(b),a.render()}}(this)),b.__super__.initialize.call(this,a)},b.prototype.render=function(){return this.delegateEvents()},b.prototype.setView=function(a){return this.view=a,this.view.render()},b}(Backbone.View),b.exports=e}).call(this)},{"./mixable":8,"./template":18}]},{},[17])(17)});