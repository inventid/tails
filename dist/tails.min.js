// Tails
// version: 0.0.2
// contributors: Joost Verdoorn,Steffan Sluis
// license: MIT
(function(){var a,b,c=[].slice,d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},e={}.hasOwnProperty,f={}.__proto__.constructor.defineProperty,g={}.__proto__.constructor.getOwnPropertyDescriptor,h=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&f(a,d,g(b,d));return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};b={Mixins:{},Utils:{},Models:{},Views:{},config:{url:"http://localhost"}},b.Utils.Hash=function(a){var b,c,d,e,f;if(c=0,0===a.length)return c;for(d=e=0,f=a.length;f>=0?f>e:e>f;d=f>=0?++e:--e)b=a.charCodeAt(d),c=(c<<5)-c+b,c&=c;return c},b.Mixins.Interceptable={InstanceMethods:{before:function(a){return this.intercept({before:a})},after:function(a){return this.intercept({after:a})},intercept:function(a){var b,d,e,f,g,h,i,j,k,l,m,n;h=this.constructor||this,n=[];for(i in a)if(e=a[i],"before"===i||"after"===i){if(null!=e.these)for(m=e.these,k=0,l=m.length;l>k;k++){if(g=m[k],"function"==typeof g)for(f in this)if(j=this[f],g===j){g=f;break}e[g]=e["do"]}e=_(e).omit("these","do"),n.push(function(){var a;a=[];for(g in e)d=e[g],_(d).isArray()||(d=[d]),a.push(function(){var a,e,f;for(f=[],a=0,e=d.length;e>a;a++)b=d[a],f.push(function(a){return function(b,d){var e,f,g,j,k,l,m,n;return(a.hasOwnProperty(b)||h.prototype.hasOwnProperty(b))&&null==a[b].before&&null==a[b].after?(g=a[b],a[b]=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],"before"===i&&(this[d]||d).apply(this,a),b=g.apply(this,a),"after"===i&&(this[d]||d).apply(this,a),b}):(f=(null!=(k=a[b])?k.klass:void 0)===h&&null!=(l=a[b])?l.before:void 0,e=(null!=(m=a[b])?m.klass:void 0)===h&&null!=(n=a[b])?n.after:void 0,"before"===i?(j=f,f=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],null!=j&&j.apply(this,a),(this[d]||d).apply(this,a)}):"after"===i&&(j=e,e=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],(this[d]||d).apply(this,a),null!=j?j.apply(this,a):void 0}),Object.defineProperty(a,b,{configurable:!0,set:function(a){return delete this[b],this[b]=function(){var b,d;return b=1<=arguments.length?c.call(arguments,0):[],null!=f&&f.apply(this,b),d=a.apply(this,b),null!=e&&e.apply(this,b),d}},get:function(){var a;return a=function(){var a,d,g,i;return a=1<=arguments.length?c.call(arguments,0):[],null!=f&&f.apply(this,a),g=null!=(i=this.constructor.__super__)?i[b]:void 0,(null!=g?g.klass:void 0)!==h&&(d=null!=g?g.apply(this,a):void 0),null!=e&&e.apply(this,a),d},a.before=f,a.after=e,a.klass=h,a}}))}}(this)(g,b));return f}.call(this));return a}.call(this))}return n}},ClassMethods:{before:function(a){return null!=("function"==typeof a?a():void 0)?this.before({initialize:function(){return this.before(a.call(this))}}):this.prototype.before(a)},after:function(a){return null!=("function"==typeof a?a():void 0)?this.before({initialize:function(){return this.after(a.call(this))}}):this.prototype.after(a)}}},b.Mixable={MixableKeywords:["included","extended","constructor","Interactions","InstanceMethods","ClassMethods"],_include:function(a){var c,e,f,g;if(null!=a.InstanceMethods)c=a.InstanceMethods;else{if(null!=a.ClassMethods)return;c=a}for(e in c)f=c[e],d.call(b.Mixable.MixableKeywords,e)<0&&null!=f&&(this.prototype[e]=f);return null!=(g=c.included)?g.apply(this):void 0},_extend:function(a){var c,e,f,g;if(null!=a.ClassMethods)c=a.ClassMethods;else{if(null!=a.InstanceMethods)return;c=a}for(e in c)f=c[e],d.call(b.Mixable.MixableKeywords,e)<0&&null!=f&&(this[e]=f);return null!=(g=c.extended)?g.apply(this):void 0},include:function(){var a,b,e,f,g,h,i,j,k;for(e=1<=arguments.length?c.call(arguments,0):[],(null!=(j=this._includedMixins)?j.klass:void 0)!==this&&(this._includedMixins=_(this._includedMixins).clone()||[],this._includedMixins.klass=this),f=0,h=e.length;h>f;f++)b=e[f],d.call(this._includedMixins,b)>=0||(null!=b&&this._includedMixins.push(b),this._include(b),null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._include(a)));for(k=this._includedMixins,g=0,i=k.length;i>g;g++)b=k[g],null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._include(a));return this},extend:function(){var a,b,e,f,g,h,i,j,k;for(e=1<=arguments.length?c.call(arguments,0):[],(null!=(j=this._extendedMixins)?j.klass:void 0)!==this&&(this._extendedMixins=_(this._extendedMixins).clone()||[],this._extendedMixins.klass=this),f=0,h=e.length;h>f;f++)b=e[f],d.call(this._extendedMixins,b)>=0||(null!=b&&this._extendedMixins.push(b),this._extend(b),null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._extend(a)));for(k=this._extendedMixins,g=0,i=k.length;i>g;g++)b=k[g],null!=b.Interactions&&(a=b.Interactions.apply(this),null!=a&&this._extend(a));return this},"with":function(a,b){return null==b&&(b={}),d.call(this._includedMixins,a)>=0||d.call(this._extendedMixins,a)>=0?b:null},concern:function(){var a,b,d,e;for(b=1<=arguments.length?c.call(arguments,0):[],d=0,e=b.length;e>d;d++)a=b[d],this.include(a),this.extend(a);return this}},b.Mixins.DynamicAttributes={InstanceMethods:{getter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.defineAttribute({getter:a})},setter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.defineAttribute({setter:a})},lazy:function(a,b){var c,d,e;null==b&&(b=null),"string"==typeof a&&null!=b&&(d=a,(a={})[d]=b),e=[];for(c in a)b=a[c],e.push(function(a){return function(b,c){var d,e;return(d={})[b]=function(){return this.attributes[b]=c()},(e={})[b]=function(a){return delete this.attributes[b],this.attributes[b]=a},a.getter(d),a.setter(e)}}(this)(c,b));return e},defineAttribute:function(a){var b,c,d,e,f;f=[];for(e in a)b=a[e],("getter"===e||"setter"===e)&&f.push(function(){var a;a=[];for(d in b)c=b[d],a.push(function(a){return function(b,c){var d;return d=Object.getOwnPropertyDescriptor(a.attributes,b)||{configurable:!0},"getter"===e?d.get=function(){return c.call(a)}:"setter"===e&&(d.set=function(b){return c.call(a,b)}),Object.defineProperty(a.attributes,b,d)}}(this)(d,c));return a}.call(this));return f}},ClassMethods:{getter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.before({initialize:function(){return this.getter(("function"==typeof a?a():void 0)||a)}})},setter:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.before({initialize:function(){return this.setter(("function"==typeof a?a():void 0)||a)}})},lazy:function(a,b){var c;return null==b&&(b=null),"string"==typeof a&&null!=b&&(c=a,(a={})[c]=b),this.before({initialize:function(){return this.lazy(("function"==typeof a?a():void 0)||a)}})},extended:function(){return this.concern(b.Mixins.Interceptable)}}},b.Collection=function(a){function c(a,d){null==a&&(a=[]),null==d&&(d={}),this.model=d.model||this.model||b.Model,this.parent=d.parent||this.parent,c.__super__.constructor.apply(this,arguments)}return h(c,a),_.extend(c,b.Mixable),c.prototype.format="json",c.prototype.urlRoot=function(){return inflection.transform(this.model.name,["underscore","pluralize"])},c.prototype.url=function(){var a,c,d,e,f,g;return a=(null!=(f=this.parent)&&"function"==typeof f.url?f.url():void 0)||(null!=(g=this.parent)?g.url:void 0)||b.url,d=("function"==typeof this.urlRoot?this.urlRoot():void 0)||this.urlRoot,c=null!=this.format?"."+(("function"==typeof this.format?this.format():void 0)||this.format):"",e=""+a+"/"+d+c},c.prototype.fetch=function(a){return null==a&&(a={}),c.__super__.fetch.call(this,_.defaults(a,{dataType:this.format}))},c.prototype.filter=function(a){return new b.Collection.Filtered(this,{filter:a})},c.prototype.where=function(a,e){var f,g,h,i,j;return null!=e?c.__super__.where.call(this,a,e):"object"==typeof a?(h=function(b){var c,d;for(c in a)if(d=a[c],b.get(c)!==d)return!1;return!0},f=function(b){var c,d,e;e=[];for(c in a)d=a[c],e.push(b.set(c,d));return e},g=function(b){var c,d,e;e=[];for(c in a)d=a[c],e.push(b.unset(c));return e},new b.Collection.Filtered(this,{filter:h,assimilate:f,distantiate:g})):"string"==typeof a?(i=a,j={is:function(a){return function(b){var c,d,e,f;return(c={})[i]=b,(d=(e=(f=a._where||(a._where={}))[i]||(f[i]={})).is||(e.is={}))[b]||(d[b]=a.where(c))}}(this),"in":function(a){return function(b){return a.filter(function(a){var c;return c=a.get(i),d.call(b,c)>=0})}}(this),atLeast:function(a){return function(b){return a.filter(function(a){return a.get(i)>=b})}}(this),atMost:function(a){return function(b){return a.filter(function(a){return a.get(i)<=b})}}(this),greaterThan:function(a){return function(b){return a.filter(function(a){return a.get(i)>b})}}(this),lessThan:function(a){return function(b){return a.filter(function(a){return a.get(i)<b})}}(this)}):void 0},c.prototype.pluck=function(a){return new b.Collection.Plucked(this,{attribute:a})},c.prototype.parse=function(a){var b,c,d,e,f;for(d=[],e=0,f=a.length;f>e;e++){if(b=a[e],b instanceof Backbone.Model){d.push(b);break}c=this.model.get(b.id),c.set(b),d.push(c)}return d},c}(Backbone.Deferred.Collection),b.Collection.Plucked=function(a){function b(a,c){null==c&&(c={}),this.collection=a,this.attribute=c.attribute,this.length=0,b.__super__.constructor.call(this,[],c),this.collection.each(function(a){return function(b){return a.trigger("add",b.get(a.attribute))}}(this)),this.listenTo(a,"change:"+this.attribute,function(a){return function(b){var c,d;return d=b.get(a.attribute),c=b.previous(a.attribute),null!=c&&a.trigger("remove",c),null!=d?a.trigger("add",d):void 0}}(this)),this.listenTo(a,"add",function(a){return function(b){var c;return c=b.get(a.attribute),null!=c&&a.trigger("add",c),a.length++}}(this)),this.listenTo(a,"remove",function(a){return function(b){var c;return c=b.get(a.attribute),null!=c&&a.trigger("remove",c),a.length--}}(this))}return h(b,a),b.prototype.contains=function(a){return d.call(this.toArray(),a)>=0},b.prototype.include=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this.contains.apply(this,a)},b.prototype.each=function(a){return this.collection.each(function(b){return function(c){return a(c.get(b.attribute))}}(this))},b.prototype.forEach=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this.each.apply(this,a)},b.prototype.toArray=function(){var a;return function(){var b,c,d,e;for(d=this.collection.toArray(),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.get(this.attribute));return e}.call(this)},b}(b.Collection),b.Collection.Filtered=function(a){function b(a,c){null==c&&(c={}),this.collection=a,this.model=this.collection.model,this.filter=c.filter,this.assimilate=c.assimilate,this.distantiate=c.distantiate,b.__super__.constructor.call(this,[],c),this.collection.each(function(a){return function(b){return a.filter(b)?a.add(b):void 0}}(this)),this.listenTo(this.collection,"add",function(a){return function(b){return a.filter(b)?a.add(b):void 0}}(this)),this.listenTo(this.collection,"remove",function(a){return function(b){return a.remove(b)}}(this)),this.listenTo(this.collection,"change",function(a){return function(b){return a.filter(b)?a.add(b):a.remove(b)}}(this)),this.on("add",function(a){return function(b){if(!a.filter(b)){if(null==a.assimilate)throw a.remove(b),Error("Cannot assimilate model.");return a.assimilate(b),a.collection.add(b)}}}(this)),this.on("remove",function(a){return function(b){if(a.collection.contains(b)&&a.filter(b)){if(null==a.distantiate)throw a.add(b),Error("Cannot distantiate model.");return a.distantiate(b)}}}(this))}return h(b,a),b}(b.Collection),b.Collection.Mirror=function(a){function b(a,c){null==c&&(c={}),c.filter=function(){return!0},b.__super__.constructor.call(this,a,c)}return h(b,a),b}(b.Collection.Filtered),b.Collection.Multi=function(a){function b(a,c){var d,e,f;for(null==a&&(a=[]),null==c&&(c={}),this.collections=[],this.modelCounts={},b.__super__.constructor.call(this,[],c),e=0,f=a.length;f>e;e++)d=a[e],this.addCollection(d)}return h(b,a),b.prototype.increment=function(a){var b,c;return(b=this.modelCounts)[c=a.cid]||(b[c]=0),++this.modelCounts[a.cid]},b.prototype.decrement=function(a){var b,c;return(b=this.modelCounts)[c=a.cid]||(b[c]=0),--this.modelCounts[a.cid]},b.prototype.addCollection=function(a){return a instanceof Backbone.Collection?(this.model||(this.model=a.model),this.collections.push(a),a.each(function(a){return function(b){return a.increment(b)}}(this)),this.listenTo(a,"add",this.increment),this.listenTo(a,"remove",this.decrement),this.trigger("addCollection",a)):void 0},b.prototype.removeCollection=function(a){var b;if(a instanceof Backbone.Collection&&(b=this.collections.indexOf(a),b>=0))return this.collections=this.collections.slice(0,b).concat(this.collections.slice(b+1,this.collections.length)),a.each(function(a){return function(b){return a.decrement(b)}}(this)),this.stopListening(a),this.trigger("removeCollection",a)},b}(b.Collection),b.Collection.Union=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.increment=function(a){return 1===b.__super__.increment.apply(this,arguments)?this.add(a):void 0},b.prototype.decrement=function(a){return 0===b.__super__.decrement.apply(this,arguments)?this.remove(a):void 0},b}(b.Collection.Multi),b.Mixins.Collectable={InstanceMethods:{included:function(){return this.concern(b.Mixins.Interceptable),this.after({initialize:function(){if(null!=this.id&&null!=this.constructor.all().get(this.id))throw new Error("Duplicate "+this.constructor.name+" for id "+this.id+".");return this.constructor.all().add(this)}})}},ClassMethods:{all:function(){var a;return(null!=(a=this._all)?a.klass:void 0)!==this&&(this._all=new b.Collection(null,{model:this}),this._all.klass=this),this._all},get:function(a){return this.all().get(a)||new this({id:a})},scope:function(a,b){return this[a]=this.all().where(b.where)}},Interactions:function(){return{ClassMethods:this["with"](b.Mixins.Storage,{extended:function(){return this.all().on("add remove",function(a){return function(b){return null!=b.id?a.store():void 0}}(this))}})}}},b.Mixins.Relations={InstanceMethods:{belongsTo:function(a){var b,c,d,e,f;return f=a.get("target"),b=a.get("attribute")||inflection.camelize(f.name,!0),d=a.get("foreignKey")||inflection.foreign_key(f.name),c=this.get(d),e=this.get(b),this.unset(d,{silent:!0}),this.unset(b,{silent:!0}),this.getter(b,function(a){return function(){return f.all().get(a.get(d))}}(this)),this.setter(b,function(a){return function(b){return null==b?a.unset(d):(null==f.all().get(b.id)&&f.create(b),a.set(d,b.id))}}(this)),this.on("change:"+d,function(a){return function(){var c,e;return c=a.get(b),e=f.all().get(a.previous(d)),null!=c&&c!==e?(e&&a.stopListening(e),a.trigger("change:"+b,a,c),a.listenTo(c,"change:id",function(b,c){return a.set(d,c)})):void 0}}(this)),null!=e?this.set(b,e):null!=c?this.set(d,c):void 0},hasOne:function(a){var b,c,d,e,f,g;return f=a.get("target"),b=a.get("attribute")||inflection.camelize(f.name,!0),c=a.get("foreignKey")||inflection.foreign_key(this.constructor.name),g=a.get("through"),e=a.get("source")||b,d=this.get(b),this.unset(b,{silent:!0}),null!=g?(this.getter(b,function(a){return function(){return a.get(g).get(e)}}(this)),this.setter(b,function(a){return function(b){return a.get(g).set(e,b)}}(this))):(this.getter(b,function(a){return function(){return f.all().where(c).is(a.id).first()}}(this)),this.setter(b,function(a){return function(b){var d;return null!=(d=f.all().where(c).is(a.id).first())&&d.unset(c),b.set(c,a.id)}}(this)),null!=d?this.set(b,d):void 0)},hasMany:function(a){var c,d,e,f,g,h,i;return g=a.get("target"),c=a.get("attribute")||inflection.transform(g.name,["camelize","pluralize"]),d=a.get("foreignKey")||inflection.foreign_key(this.constructor.name),h=a.get("through"),e=a.get("source"),null==h?this.lazy(c,function(a){return function(){return g.all().where(d).is(a.id)}}(this)):(i=this.constructor.relations().findWhere({attribute:h}),"hasMany"!==i.get("type")?this.getter(c,function(a){return function(){return a.get(h).get(e||c)}}(this)):(f=e&&i.get("target").relations().findWhere({attribute:e})||i.get("target").relations().findWhere({attribute:c,type:"hasMany"})||i.get("target").relations().findWhere({attribute:inflection.singularize(c)}),"hasMany"===f.get("type")?(e=f.get("attribute"),this.lazy(c,function(a){return function(){var c;return c=new b.Collection.Union,a.get(h).each(function(a){return c.addCollection(a.get(e))}),a.get(h).on("add",function(a){return c.addCollection(a.get(e))}),a.get(h).on("remove",function(a){return c.removeCollection(a.get(e))}),c}}(this))):(e=f.get("attribute"),this.lazy(c,function(a){return function(){return a.get(h).pluck(e)}}(this)))))},addRelation:function(a){switch(a.get("type")){case"belongsTo":return this.belongsTo(a);case"hasOne":return this.hasOne(a);case"hasMany":return this.hasMany(a)}}},ClassMethods:{belongsTo:function(a){return this.addRelation("belongsTo",a)},hasOne:function(a){return this.addRelation("hasOne",a)},hasMany:function(a){return this.addRelation("hasMany",a)},addRelation:function(b,c){var d,e,f;return d=_(c).keys()[0],f=c[d],e=new a({owner:this,type:b,attribute:d,foreignKey:c.foreignKey,through:c.through,source:c.source}),f.prototype instanceof Backbone.Model?e.set({target:f}):e.getter({target:f})},relations:function(){return a.all().where({owner:this})},extended:function(){return this.concern(b.Mixins.DynamicAttributes),this.concern(b.Mixins.Collectable),this.concern(b.Mixins.Interceptable),this.before({initialize:function(){return this.constructor.relations().each(function(a){return function(b){return a.addRelation(b)}}(this))}})}}},a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,a),_.extend(c,b.Mixable),c.concern(b.Mixins.DynamicAttributes),c.concern(b.Mixins.Collectable),c}(Backbone.Model),b.Mixins.Storage={InstanceMethods:{storage:function(){return this.constructor.storage()},indexRoot:function(){return this.constructor.indexRoot()},store:function(a){return this.constructor.store(this,a)},retrieve:function(a){return _.defaults(this.attributes,this.constructor.retrieve(this.id,a))},included:function(){return this.concern(b.Mixins.Interceptable),this.after({initialize:function(){return this.on("sync",this.store),this.retrieve(),this.store()}})}},ClassMethods:{storage:function(){return localStorage},toJSON:function(a){return("function"==typeof a.has?a.has("$el"):void 0)&&(a.get("$el").toJSON=function(){return this.clone().wrap("<div/>").parent().html()}),JSON.stringify(a)},indexRoot:function(){return inflection.transform(this.name,["underscore","pluralize"])},store:function(a,c){var d,e,f,g;if(null!=a&&null!=a.id)return d=null!=(g="function"==typeof this.indexRoot?this.indexRoot():void 0)?g:this.indexRoot,f=""+d+"/"+a.id,null!=c?(f+="/"+b.Utils.Hash(this.toJSON(c)),e=this.toJSON({instance:a,data:c})):e=this.toJSON(a),this.storage().setItem(f,e),f},retrieve:function(a,c){var d,e,f,g,h,i,j;if(e=null!=(j="function"==typeof this.indexRoot?this.indexRoot():void 0)?j:this.indexRoot,null==a){if(f=this.storage().getItem(b.Utils.Hash(e)),d=JSON.parse(f),null!=f)for(h=0,i=d.length;i>h;h++)a=d[h],this.retrieve(a);return d}return g=""+e+"/"+a,null!=c&&(g+="/"+c),f=this.storage().getItem(g),null!=f?JSON.parse(f):void 0}},Interactions:function(){return{InstanceMethods:this["with"](b.Mixins.Debug,{included:function(a){return function(){return a.after({initialize:function(){return console.log(this.toJSON(this.name)),this.after({store:function(){return this.log("Stored instances",this.constructor.all().pluck("id"))}})}})}}(this)}),ClassMethods:this["with"](b.Mixins.Collectable,{indexRoot:function(){var a;return null!=(a="function"==typeof this.urlRoot?this.urlRoot():void 0)?a:this.urlRoot},extended:function(){return this.after({store:function(){var a,b,c;return b=null!=(c="function"==typeof this.indexRoot?this.indexRoot():void 0)?c:this.indexRoot,a=this.toJSON(this.constructor.all().pluck("id")),this.constructor.storage().setItem(b,a)}})}})}}},b.Mixins.History={Interactions:function(){return{InstanceMethods:this["with"](b.Mixins.Storage,{diff:function(){var a,b,c,d,e;a={},a.apply=function(b){return function(c){var d,e,f,g;null==c&&(c=b);for(e in a){d=a[e];for(f in d)switch(g=d[f],f){case"create":c.set(e,g.value);break;case"update":c.set(e,g["new"]);break;case"delete":c.unset(e)}}return c}}(this),c=this.constructor.retrieve(this.id)||{},e=this.attributes;for(b in e)d=e[b],c[b]!==this.get(b)&&(a[b]=null!=c[b]?{update:{old:c[b],"new":this.get(b)}}:{create:{value:this.get(b)}});for(b in c)d=c[b],this.has(b)||(a[b]={"delete":{value:d}});return a},commit:function(){var a;return a=this.store(this.diff())},included:function(){return this.after({initialize:function(){return this.on("change",this.commit)}})}})}}},b.Mixins.Debug={InstanceMethods:{LOG_LEVELS:{ERROR:!0,WARNING:!0,INFO:!1},_excludedMethods:_.union(Object.keys(b.Mixins.Interceptable.InstanceMethods),["constructor","log","message","warn","error","info"]),message:function(){var a,b,d,e,f;for(d=1<=arguments.length?c.call(arguments,0):[],a=""+new Date+" - ",e=0,f=d.length;f>e;e++)b=d[e],a+="String"===b.constructor.name?b+" ":JSON.stringify(b)+" ";return a+="in "+this.constructor.name+"("+this.id+")"},error:function(){var a,b;return b=1<=arguments.length?c.call(arguments,0):[],this.LOG_LEVELS.ERROR?(a=this.message.apply(this,b),console.error(a)):void 0},warn:function(){var a,b;return b=1<=arguments.length?c.call(arguments,0):[],this.LOG_LEVELS.WARNING?(a=this.message.apply(this,b),console.warn(a)):void 0},log:function(){var a,b;return b=1<=arguments.length?c.call(arguments,0):[],a=this.message.apply(this,b),console.log(a)},info:function(){var a,b;return b=1<=arguments.length?c.call(arguments,0):[],this.LOG_LEVELS.INFO?(a=this.message.apply(this,b),console.log(a)):void 0},included:function(){return this.concern(b.Mixins.Interceptable),this.after({initialize:function(){var a,b,e,f,g,h,i;for(a=1<=arguments.length?c.call(arguments,0):[],this.info("Called function 'initialize' of "+this.constructor.name+" with arguments:",a),this.on("change",function(a){return function(b){return a.info("Change of attributes:",b.changedAttributes())}}(this)),b=function(){var a;a=[];for(e in this)f=this[e],f instanceof Function&&d.call(this._excludedMethods,e)<0&&a.push(e);return a}.call(this),i=[],g=0,h=b.length;h>g;g++)e=b[g],i.push(function(a){return function(b){return a.after({these:[b],"do":function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this.info("Called function '"+b+"' of "+this.constructor.name+" with arguments:",a)}})}}(this)(e));return i}})}}},b.Model=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,a),_.extend(c,b.Mixable),c.concern(b.Mixins.Relations),c.prototype.format="json",c.prototype.initialize=function(a,b){var d;return null==a&&(a={}),null==b&&(b={}),this.parent=b.parent||this.parent||(null!=(d=this.collection)?d.parent:void 0),c.__super__.initialize.apply(this,arguments)},c.prototype.urlRoot=function(){return inflection.transform(this.constructor.name,["underscore","pluralize"])},c.prototype.url=function(){var a,c,d,e,f,g,h;return a=(null!=(g=this.parent)&&"function"==typeof g.url?g.url():void 0)||(null!=(h=this.parent)?h.url:void 0)||b.config.url,e=("function"==typeof this.urlRoot?this.urlRoot():void 0)||this.urlRoot,d=this.id?"/"+this.id:"",c=null!=this.format?"."+(("function"==typeof this.format?this.format():void 0)||this.format):"",f=""+a+"/"+e+d+c},c.prototype.fetch=function(a){return null==a&&(a={}),c.__super__.fetch.call(this,_.defaults(a,{dataType:this.format}))},c.prototype.save=function(a){return null==a&&(a={}),c.__super__.save.call(this,_.defaults(a,{dataType:this.format}))},c}(Backbone.Deferred.Model),b.Template=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,a),c.concern(b.Mixins.Collectable),c.prototype.urlRoot="assets",c.prototype.format="html",c.prototype.bind=function(a){return this.fetch({parse:!0}).then(function(b){return function(){var c;return c=$(b.get("$el")).clone(),rivets.bind(c,a),c}}(this))},c.prototype.parse=function(a){return{$el:$(a)}},c}(b.Model),b.View=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return h(c,a),_.extend(c,b.Mixable),c.prototype.initialize=function(a){return null==a&&(a={}),this.template.constructor===String&&(this.template=b.Template.get(this.template)),this.template.bind(this).then(function(a){return function(b){return a.setElement(b),a.render()}}(this)),c.__super__.initialize.call(this,a)},c.prototype.render=function(){return this.delegateEvents()},c.prototype.setView=function(a){return this.view=a,this.view.render()},c}(Backbone.View),b.factory=function(a){return a._=b,a.Mixable=b.Mixable,a.Model=b.Model,a.Collection=b.Collection,a.View=b.View,a.Template=b.Template,a.Mixins=b.Mixins,a.Utils=b.Utils,a.Models=b.Models,a.Views=b.Views,a.config=b.config,a.configure=function(a){var c,d;null==a&&(a={});for(c in a)d=a[c],b.config[c]=d}},"object"==typeof exports?b.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(a){return b.factory(this.Tails=a),a}):b.factory(this.Tails={})}).call(this);